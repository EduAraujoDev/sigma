{% extends "base_layout.twig" %}
{% block title %}Listar Clientes{% endblock %}
{% block content_header %}
    <section class="content-header">
        <h1>
            Área Administrador
            <small>Adicionar Clientes</small>
        </h1>
        <ol class="breadcrumb">
            <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active">Adicionar Clientes</li>
        </ol>
    </section>
{% endblock %}
{% block content %}
    <section class="content">
        <div class="col-xs-12 col-sm-12 col-md-12">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h1 class="box-title">Dados do usuário<br><small>*Campos obrigatorios</small></h1>
                </div>

                <form class="form-horizontal" name="frmCliente" role="form" action="{{base_url}}cliente/adicionar" method="post" 
                      class="form-incline" onSubmit="return btnCadastrar();">
                    <div id="box"></div>
                    <div class="box-body">        

                        <div class="form-group">
                            <div class="col-xs-12 col-sm-6 col-md-6" id="divNome">
                                <label for="login">Nome*</label>
                                <input type="text" class="form-control" name="nome" id="nome"
                                   placeholder="Digite o nome" maxlength="80" onBlur="verificarNome();">
                            </div>

                            <div class="col-xs-12 col-sm-6 col-md-6">
                                <label for="email">E-mail</label>
                                <input type="email" class="form-control" name="email" 
                                   placeholder="Digite o email" maxlength="80">
                            </div>
                        </div>    

                        <div class="form-group">
                            <div class="hidden-xs col-sm-4 col-md-4" id="divCpf">
                                <label for="cpf_cnpj">CPF/CNPJ*</label>
                                <input type="text" class="form-control" id="cpf" name="cpf_cnpj" 
                                   placeholder="Digite o cpf ou cnpj" maxlength="14" onBlur="verificarCPF();">
                            </div>

                            <div class="hidden-xs col-sm-4 col-md-4">
                                <label for="data_nascimento">Data de Nascimento</label>
                                <div class="input-group">
                                <input id="data_nascimento" type="text" class="form-control" name="data_nascimento" 
                                   placeholder="Digite a data de nascimento">
                                <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                                </div>
                            </div>    

                            <div class="hidden-xs col-sm-4 col-md-4">
                                <label for="cep">CEP</label>
                                <input type="text" class="form-control" id="cep"  name="cep" 
                                   placeholder="Digite o cep" maxlength="10" onkeyup="getEndereco(event);">
                            </div>   
                        </div>    

                        <div class="form-group">
                            <div class="hidden-xs col-sm-10 col-md-10">
                                <label for="logradouro">Logradouro</label>
                                <input type="text" class="form-control"  name="logradouro" 
                                   placeholder="Digite o logradouro" maxlength="100">
                            </div>

                            <div class="hidden-xs col-sm-2 col-md-2">
                                <label for="numero">Número</label>
                                <input type="text" class="form-control"  name="numero" 
                                   placeholder="Digite o número" maxlength="11">
                            </div>
                        </div>    

                        <div class="form-group">
                            <div class="hidden-xs col-sm-5 col-md-5">
                                <label for="bairro">Bairro</label>
                                <input type="text" class="form-control"  name="bairro" 
                                   placeholder="Digite o bairro" maxlength="40">
                            </div>    

                            <div class="hidden-xs col-sm-5 col-md-5">
                                <label for="cidade">Cidade</label>
                                <input type="text" class="form-control"  name="cidade" 
                                   placeholder="Digite a cidade" maxlength="50">
                            </div>    

                            <div class="hidden-xs col-sm-2 col-md-2">
                                <label for="uf">Estado</label>
                                <input type="text" class="form-control"  name="uf" 
                                   placeholder=" Digite o estado" maxlength="3">
                            </div>
                        </div>    

                        <div class="form-group">
                            <div class="hidden-xs col-sm-12 col-md-12">
                                <label for="complemento">Complemento</label>
                                <input type="text" class="form-control"  name="complemento" 
                                   placeholder="Digite o complemento" maxlength="100">
                            </div>        
                        </div>    

                        <div class="form-group">
                            <div class="col-xs-12 col-sm-6 col-md-6">
                                <label for="telefone_residencial">Telefone</label>
                                <input id="telefone" type="text" class="form-control"  name="telefone_residencial" 
                                   placeholder="Digite o telefone residencial" maxlength="18">
                            </div>

                            <div class="col-xs-12 col-sm-6 col-md-6" id="divCelular">
                                <label for="celular">Celular*</label>
                                <input  id="celular"type="text" class="form-control" id="celular" name="celular" 
                                    placeholder="Digite o celular" maxlength="18" onBlur="verificarCelular();">
                            </div>
                        </div>
                            
                        <div class="form-group">
                            <div class="col-xs-12 col-sm-12 col-md-12">
                                <label>Observações</label>
                                <textarea class="form-control" name="observacoes" rows="3" placeholder=""></textarea>
                            </div>
                        </div>    

                    </div>

                    <div class="box-footer text-right">
                        <button type="submit" class="btn btn-success">Cadastrar</button>
                        <a href="{{base_url}}cliente/listar">
                        <button type="button" class="btn btn-danger">Cancelar</button></a>    
                    </div>    
                </form>
            </div>
        </div>
    </section>
{% endblock %}

{% block js %}
    {{ parent() }}
    <script type="text/javascript">
        jQuery(function ($) {
            $("#cep").mask("99999-999");
            $("#cpf").mask("999.999.999-99");
            $("#data_nascimento").mask('99/99/9999');
            $("#telefone").mask("(999) 9999-9999");
            $("#celular").mask("(999) 99999-9999");
            
            $('#data_nascimento').datepicker({
               format: 'dd/mm/yyyy' 
            }).datepicker('setDate', new Date());
        });
        
        function btnCadastrar(){
           if (verificarNome() & verificarCelular() & verificarCPF()) {
             return true;   
           } else {
             document.querySelector("#box").innerHTML = '<div class="alert alert-danger alert-dismissible fade in" role="alert" id="alerta"><button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button><strong>Existem campos que devem ser preenchidos!</strong></div>';
             return false;
           }
        }
        
        function verificarNome() {
            var nome = $("#nome").val();
            if(nome.length === 0) {
                document.querySelector("#divNome").setAttribute('class', 'col-xs-12 col-sm-6 col-md-6 has-error has-feedback');
                document.querySelector("#nome").focus();
                return false;
            } else {
                document.querySelector("#divNome").setAttribute('class', 'col-xs-12 col-sm-6 col-md-6');
                return true;
            }
            
        }

        function verificarCelular() {
            var celular = $("#celular").val().replace(/[^\d]+/g, '');
            if(celular.length !== 12) {
                document.querySelector("#divCelular").setAttribute('class', 'col-xs-12 col-sm-6 col-md-6 has-error has-feedback');
                document.querySelector("#celular").focus();
                return false;
            } else {
                document.querySelector("#divCelular").setAttribute('class', 'col-xs-12 col-sm-6 col-md-6');
                return true;
            }
        }
        
        function verificarCPF() {
            var cpf = $("#cpf").val().replace(/[^\d]+/g, '');
            if (testaCPF(cpf) === false) {
                document.querySelector("#divCpf").setAttribute('class', 'hidden-xs col-sm-4 col-md-4 has-error has-feedback');
                document.querySelector("#cpf").focus();
                return false;
            } else {
                document.querySelector("#divCpf").setAttribute('class', 'hidden-xs col-sm-4 col-md-4');
                return true;
            }
        };

        function testaCPF(strCPF) {
            var Soma;
            var Resto;
            Soma = 0;
            if (strCPF.length !== 11 || strCPF === "00000000000" || strCPF === "11111111111" || strCPF === "22222222222" ||
                    strCPF === "33333333333" || strCPF === "44444444444" || strCPF === "55555555555" || strCPF === "66666666666" ||
                    strCPF === "77777777777" || strCPF === "88888888888" || strCPF === "99999999999")
                return false;

            for (i = 1; i <= 9; i++)
                Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (11 - i);
            Resto = (Soma * 10) % 11;

            if ((Resto === 10) || (Resto === 11))
                Resto = 0;
            if (Resto !== parseInt(strCPF.substring(9, 10)))
                return false;

            Soma = 0;
            for (i = 1; i <= 10; i++)
                Soma = Soma + parseInt(strCPF.substring(i - 1, i)) * (12 - i);
            Resto = (Soma * 10) % 11;

            if ((Resto === 10) || (Resto === 11))
                Resto = 0;
            if (Resto !== parseInt(strCPF.substring(10, 11)))
                return false;
            return true;
        }


        function getEndereco(event) {
            var cep = $("#cep").val();
            var x = event.which || event.keyCode;
            if (cep.match(/\d{5}-\d{3}/) && ((x >= 48 && x <= 57) || (x >= 96 && x <= 105))) {
                $.getJSON("http://api.postmon.com.br/v1/cep/" + cep + "?format=json", function (retorno) {
                    $('input[name=logradouro]').val(retorno.logradouro);
                    $('input[name=bairro]').val(retorno.bairro);
                    $('input[name=cidade]').val(retorno.cidade);
                    $('input[name=uf]').val(retorno.estado);
                });
            }
        }
    </script>
{% endblock %}